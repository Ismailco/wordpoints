!function(a){var b;b={state:{},l10n:WordPointsUserPointsTableL10n,data:WordPointsUserPointsTableData,dialogTemplate:wp.wordpoints.utils.template("user-points-dialog"),init:function(){a(".wrap").on("click","input.wordpoints-add-points, input.wordpoints-subtract-points",b.onClick)},onClick:function(c){c.preventDefault();var d=a(c.target),e=d.siblings('input[type="number"]'),f=parseInt(e.val(),10);return isNaN(f)||f<1?void b.invalidInput():(b.state={},b.state.points=f,b.state.row=e.parents("tr"),b.state.current=parseInt(b.state.row.find("td.points").html(),10),d.hasClass("wordpoints-add-points")?b.state.action="add":b.state.action="subtract","subtract"===b.state.action&&b.state.current-b.state.points<b.data.pointsMinimum?void b.invalidInput(wp.wordpoints.utils.textTemplate(b.l10n.lessThanMinimum)({minimum:b.data.pointsMinimum})):void b.confirm())},invalidInput:function(c){c=c||b.l10n.invalidInputText,a("<div></div>").attr("title",b.l10n.invalidInputTitle).append(a("<p></p>").text(c)).dialog({dialogClass:"wp-dialog",resizable:!1,draggable:!1,height:"auto",modal:!0,buttons:[{text:b.l10n.closeButtonText,"class":"button",click:function(){a(this).dialog("close")}}]})},confirm:function(){var c,d,e=b.state.current;"add"===b.state.action?(c=b.l10n.addButtonText,d=e+" + "+b.state.points+" = "+(e+b.state.points)):(c=b.l10n.subtractButtonText,d=e+" - "+b.state.points+" = "+(e-b.state.points)),a(b.dialogTemplate({total:d})).find(".wordpoints-points-user").append(b.state.row.find("td.username").html()).end().dialog({dialogClass:"wp-dialog",resizable:!1,draggable:!1,height:"auto",modal:!0,buttons:[{text:b.l10n.cancelButtonText,"class":"button",click:function(){a(this).dialog("close")}},{text:c,"class":"button button-primary",click:function(){var c=a(this);b.state.reason=c.find("input").val(),c.html(a("<p></p>").text(b.l10n.waitMessage).prepend(a("<span></span>").addClass("spinner is-active"))),c.dialog("option","buttons",{}),b.state.dialog=c,b.submit()}}]})},submit:function(){a.post(ajaxurl,{action:"wordpoints_points_alter_user_points",points:b.state.points,alter:b.state.action,reason:b.state.reason,user_id:b.state.row.data("wordpoints-points-user-id"),type:b.data.pointsType,_ajax_nonce:b.data.nonce}).done(function(a){return a.success?(b.state.response=a,void b.success()):void b.error()}).fail(function(){b.error()})},error:function(c){c||(c=b.l10n.errorMessage);var d=b.state.dialog;d.html(a("<p></p>").text(c)),d.dialog("option","buttons",[{text:b.l10n.closeButtonText,"class":"button button-primary",click:function(){a(this).dialog("close")}}])},success:function(){b.state.dialog.dialog("close"),b.state.row.find("td.points").html(b.state.response.data.points).effect("highlight",{},3e3),wp.a11y.speak(b.l10n.successMessage)}},a(document).ready(function(){b.init()})}(jQuery);